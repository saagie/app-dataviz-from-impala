var app=angular.module("app",["nvd3"]);app.controller("main",["$scope",function(e){var t=[];t[0]={},t[0].boxes=[],t[0].boxes[0]={type:"text",text:"<h1>Data Story Title</h1><p>Start your data story here.</p>"},t[0].boxes[1]={type:"empty"},e.page=t[0],e.pages=t,e.pageindex=0,e.prevPage=function(){e.pageindex=e.pageindex-1},e.nextPage=function(){e.pageindex=e.pageindex+1},e.newPage=function(){var a={};a.boxes=[],a.boxes[0]={type:"empty"},a.boxes[1]={type:"empty"},t.splice(e.pageindex+1,0,a)},e.edit=!1,e.$on("showEdit",function(t,a){e.edit=!0,e.currentbox=a}),e.$on("closeEdit",function(){e.edit=!1}),e.requestbuilder=!1,e.$on("showRequestBuilder",function(t,a){e.requestbuilder=!0,e.currentbox=a}),e.$on("closeRequestBuilder",function(){e.requestbuilder=!1})}]),app.directive("box",function(){return{templateUrl:"app/box.html",restrict:"E",scope:{box:"="},link:function(e,t,a,n){e.edit=!1,e.changeChart=function(){e.edit=!0},e.changeBoxType=function(e,t){t.type=e,"text"==e&&(t.text="Change text here"),"image"==e&&(t.imgurl="assets/report.jpg"),(e="chart")&&(t.chart_options={chart:{type:"discreteBarChart",height:450,margin:{top:20,right:20,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},transitionDuration:500,xAxis:{axisLabel:"X Axis"},yAxis:{axisLabel:"Y Axis",axisLabelDistance:30}}},t.chart_data=[{key:"Cumulative Return",values:[{label:"A",value:-29.765957771107},{label:"B",value:0},{label:"C",value:32.807804682612},{label:"D",value:196.45946739256},{label:"E",value:.19434030906893},{label:"F",value:-98.079782601442},{label:"G",value:-13.925743130903},{label:"H",value:-5.1387322875705}]}],t.chart_config={visible:!0,extended:!1,disabled:!1,autorefresh:!0,refreshDataOnly:!1})},e.edit=function(t){e.$emit("showEdit",t)}}}}),app.directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){function i(){n.$setViewValue(t.html())}n.$render=function(){t.html(n.$viewValue||"")},t.bind("blur keyup change",function(){e.$apply(i)})}}}),app.directive("edit",function(){return{templateUrl:"app/edit.html",restrict:"E",scope:{box:"="},link:function(e,t,a,n){e.menu="options",e.sources=[],e.addSource=function(t){var a={};a.type=t,e.sources.push(a)},e.buildRequest=function(t){e.$emit("showRequestBuilder",t)},e.close=function(){e.$emit("closeEdit")},e.chart_type=e.box.chart_options.chart.type,e.charts=[],e.charts[0]={name:"Discrete Bar Chart",key:"discreteBarChart"},e.charts[1]={name:"Donut Chart",key:"donutChart"},e.changeChartType=function(e,t){"donutChart"==e&&(t.chart_options={chart:{type:"pieChart",height:450,donut:!0,x:function(e){return e.key},y:function(e){return e.y},showLabels:!0,pie:{startAngle:function(e){return e.startAngle/2-Math.PI/2},endAngle:function(e){return e.endAngle/2-Math.PI/2}},transitionDuration:500,legend:{margin:{top:5,right:70,bottom:5,left:0}}}},t.chart_data=[{key:"One",y:5},{key:"Two",y:2},{key:"Three",y:9},{key:"Four",y:7},{key:"Five",y:4},{key:"Six",y:3},{key:"Seven",y:.5}]),"discreteBarChart"==e&&(t.chart_options={chart:{type:"discreteBarChart",height:450,margin:{top:20,right:20,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},transitionDuration:500,xAxis:{axisLabel:"X Axis"},yAxis:{axisLabel:"Y Axis",axisLabelDistance:30}}},t.chart_data=[{key:"Cumulative Return",values:[{label:"A",value:-29.765957771107},{label:"B",value:0},{label:"C",value:32.807804682612},{label:"D",value:196.45946739256},{label:"E",value:.19434030906893},{label:"F",value:-98.079782601442},{label:"G",value:-13.925743130903},{label:"H",value:-5.1387322875705}]}])}}}}),app.directive("requestbuilder",function(){return{templateUrl:"app/requestbuilder.html",restrict:"E",scope:{box:"="},link:function(e,t,a,n){e.menu="wizard",e.close=function(){e.$emit("closeRequestBuilder")}}}}),angular.module("webapp").run(["$templateCache",function(e){e.put("app/box.html",'<div><button ng-if="box.type != \'empty\' && box.type != undefined" class="btn glyphicon glyphicon-remove btn-close" ng-click="changeBoxType(\'empty\',box)"></button> <button ng-if="box.type == \'chart\'" class="btn glyphicon glyphicon-pencil btn-edit" ng-click="edit(box)">Edit</button> <button ng-if="box.type == \'chart\'" class="btn glyphicon glyphicon-search btn-drilldown" ng-click="drilldown(box)">Add a Drill Down</button><div ng-if="box.type == \'text\'" contenteditable="" ng-model="box.text" strip-br="true" select-non-editable="true"></div><div ng-if="box.type == \'empty\' || box.type == undefined"><button class="btn glyphicon glyphicon-font" ng-click="changeBoxType(\'text\',box)">Text</button> <button class="btn glyphicon glyphicon-picture" ng-click="changeBoxType(\'image\',box)">Image</button> <button class="btn glyphicon glyphicon glyphicon-stats" ng-click="changeBoxType(\'chart\',box)">Graph</button> <button class="btn glyphicon glyphicon-th-list" ng-click="changeBoxType(\'table\',box)">Dynamic Table</button></div><div ng-if="box.type == \'image\'"><img src="{{box.imgurl}}"></div><div ng-if="box.type == \'chart\'"><nvd3 options="box.chart_options" data="box.chart_data" config="box.chart_config"></nvd3></div></div>'),e.put("app/edit.html",'<div><button class="btn glyphicon glyphicon-remove btn-close" ng-click="close()"></button><ul class="nav nav-pills"><li role="presentation" ng-class="[{active: menu == \'options\'}]" ng-click="menu=\'options\'"><a href="#">Edition</a></li><li role="presentation" ng-class="[{active: menu == \'data\'}]" ng-click="menu=\'data\'"><a href="#">Data</a></li></ul><div ng-if="menu==\'options\'"><div ng-if="box.type == \'chart\'"><h3>Main</h3><label>Type</label><select id="selectChart" ng-model="chart_type" ng-change="changeChartType(chart_type,box)" ng-options="chart.key as chart.name for chart in charts" class="form-control"></select><label>Extended</label><input type="checkbox" ng-model="box.chart_config.extended" class="form-control"> <label>Transition Duration</label><input type="text" ng-model="box.chart_options.chart.transitionDuration" class="form-control"><h3>Axis</h3><label>X Axis Label</label><input type="text" ng-model="box.chart_options.chart.xAxis.axisLabel" class="form-control"> <label>Y Axis Label</label><input type="text" ng-model="box.chart_options.chart.yAxis.axisLabel" class="form-control"></div></div><div ng-if="menu==\'data\'"><label>Datalake</label><select id="source_type" ng-model="source_type" class="form-control"><option class="capsule capsule-impala" value="impala">Impala</option><option class="capsule capsule-hive" value="hive">Hive</option></select><button class="btn btn-primary" ng-click="addSource(source_type)">add</button><hr><label>Datamart</label><select id="source_type_dm" ng-model="source_type" class="form-control"><option class="capsule capsule-mongo" value="mongo">Mongo</option><option class="capsule capsule-mysql" value="mysql">MySQL</option></select><button class="btn btn-primary" ng-click="addSource(source_type_dm)">add</button><ul class="list-group"><li ng-repeat="source in sources" class="list-group-item capsule capsule-{{source.type}}">{{source.type}}</li></ul><label>Your data request</label> <button class="btn btn-primary" ng-click="buildRequest(box)">Build your request</button></div></div>'),e.put("app/requestbuilder.html",'<div><button class="btn glyphicon glyphicon-remove btn-close" ng-click="close()"></button><ul class="nav nav-pills"><li role="presentation" ng-class="[{active: menu == \'wizard\'}]" ng-click="menu=\'wizard\'"><a href="#">Wizard</a></li><li role="presentation" ng-class="[{active: menu == \'raw\'}]" ng-click="menu=\'raw\'"><a href="#">I\'m a boss, I know how to wrote SQL request</a></li></ul><div ng-if="menu==\'wizard\'"><div class="fakewizard">Here it is a fantastic wizard.</div></div><div ng-if="menu==\'raw\'"><textarea class="form-control" rows="10">select label, value from table</textarea> <button class="btn btn-primary">Request</button></div><div class="row"><div class="col-md-6"><table class="table table-striped"><tr><th>label</th><th>value</th></tr><tr ng-repeat="item in box.chart_data[0].values"><td>{{item.label}}</td><td>{{item.value}}</td></tr></table></div><div class="col-md-6"><nvd3 options="box.chart_options" data="box.chart_data" config="box.chart_config"></nvd3></div></div></div>')}]);